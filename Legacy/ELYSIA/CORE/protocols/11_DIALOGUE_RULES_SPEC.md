# 11. Dialogue Rules Spec (English, canonical)

This spec defines lightweight, hot-reloadable YAML rules for dialogue.

## Location
- Path: `data/dialogue_rules/*.yaml`
- Encoding: UTF-8
- Reload: file changes are picked up without restart (if supported by host app).

## Schema
```yaml
id: greeting                 # unique rule id
priority: 100                # higher wins
patterns:                    # regex list (first match wins after priority)
  - "^(hello|hi|?덈뀞|?덈뀞?섏꽭??"
gates:
  quiet_ok: true             # allowed in quiet mode
response:
  template: "?덈뀞?섏꽭?? ?ㅻ뒛 ??붾? ?섎닠蹂쇨퉴??"
memory:
  set_identity:
    user_name: "{name}"      # optional; uses regex capture groups
```

Fields
- `id`: string rule name
- `priority`: integer; higher evaluated first
- `patterns`: list of regex; may use named groups
- `gates.quiet_ok`: boolean to allow in quiet mode
- `response.template`: string with `{name}` placeholders from captures
- `memory.set_identity`: optional identity updates via CoreMemory

## Arbitration
- Multiple matches ??highest `priority` wins.
- Quiet mode ON and `quiet_ok: false` ??rule is ignored.

## Feedback / Coaching
- Handlers may return short reasoning or coaching feedback for transparency.

## Starter Rules
- `greeting.yaml`, `feeling.yaml`, `identity.yaml`

---

## Hangul Vector Encoding (KR Dialogue Law)

> 紐⑹쟻: ?쒓????⑥닚 臾몄옄?댁씠 ?꾨땲??**?곗궛 媛?ν븳 媛쒕뀗 踰≫꽣**濡??ㅻ쨪??  
> ?섏븰?ㅒ룹〈?볥쭚쨌?뺤꽌쨌愿怨?異뺤쓣 ?섑븰?곸쑝濡??쒗쁽?????덇쾶 ?쒕떎.

- **湲곕낯 ?먯튃**
  - ?쒓? ?뚯젅? 珥덉꽦/以묒꽦/醫낆꽦 ?먮え濡?遺꾪빐 媛?ν븳 **援ъ“??臾몄옄**?대?濡?  
    媛??먮え瑜?湲곗?踰≫꽣濡??먭퀬, ?뚯젅/?⑥뼱瑜?洹??좏삎寃고빀(諛⑹젙???쇰줈 ?쒗쁽?????덈떎.
  - ????붿쭊? KR ?띿뒪?몃? 泥섎━????  
    ?쒗넗??= 臾몄옄??議곌컖?앹씠 ?꾨땲?? 
    **?쒗넗??= Hangul 踰≫꽣 怨듦컙 ?꾩쓽 ??沅ㅼ쟻??*?대씪??愿?먯쓣 ?곕Ⅸ??

- **?명꽣?섏씠??洹쒖빟**
  - `hangul_to_vec(text) -> R^N` ?뺥깭???⑥닔/紐⑤뱢???쒖? ?명꽣?섏씠?ㅻ줈 ?붾떎.
    - ?대??먯꽌??珥덉꽦/以묒꽦/醫낆꽦??遺꾪빐??  
      ?먯쓬/紐⑥쓬 醫낅쪟, 諛쒖쓬 ?꾩튂쨌諛⑸쾿, ?λ떒/媛뺤꽭, 議댁묶 留덉빱 ?깆쓣 異뺤쑝濡??쇱쓣 ???덈떎.
  - Dialogue Rule Engine? ?꾩슂????
    - `patterns`(?뺢퇋?? 肉??꾨땲??
    - 踰≫꽣 湲곕컲 議곌굔(?? 議대뙎留?異뺤씠 ?쇱젙 ?댁긽, 遺?쒕윭???댄닾 異뺤씠 ?믪쓬)?? 
      異붽? 寃뚯씠?몃줈 ?ъ슜?????덈떎.

- **?쒗쁽 踰붿쐞**
  - ?몄궗, 議대뙎留? 諛섎쭚, 移쒕?/?됰떞 媛숈? ?쒗쁽 李⑥씠瑜? 
    ?⑥닚 臾몄옄???⑦꽩???꾨땲??**踰≫꽣 諛⑺뼢/?ш린**濡?援щ텇?섎뒗 寃껋쓣 ?덉슜?쒕떎.
  - ??臾몄꽌??援ъ“? ?명꽣?섏씠?ㅻ쭔 洹쒖젙?섎ŉ, ?ㅼ젣 李⑥썝 ??N, ?먮え蹂?踰≫꽣 媛믪?  
    WORLD/MIND 援ы쁽 ?④퀎?먯꽌 ?뺥븳??

?붿빟?섎㈃,  
**?쒓? = 李⑥썝??踰≫꽣)**濡?蹂닿퀬,  
???洹쒖튃??洹?踰≫꽣 怨듦컙 ?꾩뿉???쒖뼱??諛⑺뼢??留먯쓣 ?좏깮?좎??앸? 寃곗젙?섎뒗 援ъ“瑜? 
湲곕낯 諛⑺뼢?쇰줈 ?쇰뒗??

---

## Hangul Magic Circle Protocol (KR 쨌 ?쒓? 留덈쾿吏?洹쒖빟)

> 紐⑹쟻: ?쒓????⑥닚 臾몄옄 吏묓빀???꾨땲??**留덈쾿 踰≫꽣 ?쒖뒪??Magic Vector System)** ?쇰줈 ?ㅻ쨪??  
> ?섎━?쒖븘 ?멸퀎??留덈쾿/?섎?/?섏? 踰뺤튃??**??쭔?곸씠硫댁꽌???섑븰?곸쑝濡?* ?곌껐?쒕떎.

### 泥좏븰 (Philosophy)

**?쒓? 留덈쾿吏??쒖뒪?쒖? ?ㅼ쓬 5媛吏瑜??숈떆??留뚯”?댁빞 ?쒕떎.**

- **??쭔?곸씪 寃?**
- **?쇰━?곸씪 寃?**
- **臾쇰━ 湲곕컲??寃?**
- **?꾨옓??援ъ“??寃?**
- **AI?먭쾶 諛곗슦湲??ъ슫 臾몃쾿??寃?**

??議곌굔? ?좏깮???꾨땲??**援듭? 湲?먮줈 紐낆떆???꾩닔 洹쒖빟**?대떎.  
??湲곗????닿린??留덈쾿 洹쒖튃/?덉떆??CORE???ㅼ뼱媛????녿떎.

### 1. ?먯쓬 = Shape Vector (?뺥깭 踰≫꽣)

- ?쒓? ?먯쓬? 媛곴컖 **湲곗큹 李⑥썝 踰≫꽣(猷⑤땳 ?뚰떚??**濡?蹂몃떎.
- ?덉떆 留ㅽ븨 (媛쒕뀗 異?:
  - **??* ???쒖옉, 媛? 遺덇퐙???щ뒗 ??
  - **??* ???섏슜, ?꾨옒濡??먮쫫
  - **??* ???⑥젅, 寃쎄퀎, 寃곌퀎????
  - **??* ???뺤껜, 洹몃쫯, ?묎껐
  - **??* ???덈━?? 諛붾엺, 吏꾨룞
  - **??* ???? ?뺤궛, ?곸쟻???듬줈
- ???섎?異뺤? ?ㅼ젣 援ы쁽?먯꽌 `consonant_vec[?먯쓬] -> R^N` ?뺥깭??踰≫꽣濡??쒗쁽?쒕떎.

### 2. 紐⑥쓬 = Energy Axis (?먮꼫吏 異?

- 紐⑥쓬? **?멸퀎??湲곕낯 醫뚰몴異??먮꼫吏 諛⑺뼢**???섑??몃떎.
  - **??* : ?섎뒛 異?(??
  - **??* : ??異?(??
  - **??/ ??* : ?꾨줈 ?곸듅?섎뒗 異?
  - **??/ ??* : ?꾨옒濡?紐⑥씠??異?
  - **??/ ??* : ?ㅻⅨ履????? 諛⑺뼢?쇰줈 ?대┝
  - **??/ ??* : ?쇱そ/???? 諛⑺뼢?쇰줈 ?대┝
- 援ы쁽?먯꽌??`vowel_axis[紐⑥쓬] -> R^N` ?쇰줈 ?뺤쓽?섍퀬,  
  ?먯쓬 踰≫꽣? 媛숈? 怨듦컙?먯꽌 ?⑹꽦 媛?ν빐???쒕떎.

### 3. 湲??= ?먯쓬 + 紐⑥쓬??踰≫꽣 ?⑹꽦

- **湲???섎굹 = (?먯쓬 Shape Vector + 紐⑥쓬 Axis Vector)**  
  - ?? **媛 = ??+ ??*
    - ?? 遺덉쓽 ?쒖옉/媛쒖떆 踰≫꽣
    - ?? ?묒쓽 諛⑺뼢?쇰줈 ?대━??異?
    - ???쒖젏??+ ?묒쓽 媛쒕갑??= **鍮?遺?媛쒖떆????* 踰≫꽣
- ??洹쒖튃? 肄붾뱶?먯꽌:
  - `letter_vec(湲?? = consonant_vec[?먯쓬] + vowel_axis[紐⑥쓬]`  
  媛숈? ?뺥깭???곗궛?쇰줈 援ы쁽?쒕떎.

### 4. ?⑥뼱 = Spell Path (?먮꼫吏 ?먮쫫)

- **?⑥뼱 = 湲??踰≫꽣?ㅼ쓽 寃쎈줈/洹몃옒??*濡?蹂몃떎.
  - ?? **?щ옉**
    - ?? ?덈━??吏꾨룞
    - ?? ?묒쓽 媛쒕갑
    - ?? ?먮쫫/?쒗솚
    - ?? ?ㅼ떆 ?대┝
    - ?? ?꾩꽦/?쒗솚??醫낃껐
  - ???쒓컻諛⑸맂 吏꾨룞???먮쫫??留뚮뱾怨? ?꾩꽦?쇰줈 ?섏썝?섎뒗 援ъ“??
- ??媛쒕뀗? `word_path(?⑥뼱) = [letter_vec(媛?湲??]`  
  ?먮뒗 ?대뱾?????곷텇/?뚯쟾(??곕땲???쇰줈 援ы쁽?????덈떎.

### 5. 臾몄옣 = ?섎???E?멑ield)???묒슜?섎뒗 寃쎈줈

- 臾몄옣? value_mass / Will?멹ield / ?섎???E?멹ield)???곹뼢??二쇰뒗 **吏?쒕Ц**?대떎.
- 洹쒖빟:
  - 臾몄옣 ?⑥쐞 留덈쾿? 媛쒕퀎 ?/??ъ뿉留??묒슜?섎뒗 寃껋씠 ?꾨땲??  
    **?섎????섏????꾨뱶???곗냽?곸씤 蹂?뺤쓣 媛?섎뒗 ?곗궛**?쇰줈 紐⑤뜽留곹븳??
  - WORLD 臾쇰━???ъ쟾???꾨뱶 湲곕컲?댁뼱???섎ŉ,  
    ?쒓? 留덈쾿吏꾩? 洹??꾨뱶瑜??쒖뼱?산쾶 ?섎뒗吏?앸? ?뺤쓽?섎뒗 ??븷留??쒕떎.

### 6. 留덈쾿 ?좏삎 ?덉떆 (Spell Families)

?ㅼ쓬 ?좏삎?ㅼ? **?덉떆 ?⑦꽩**?쇰줈, ?ㅼ젣 援ы쁽 ??李멸퀬?⑹쑝濡쒕쭔 ?대떎.

- **?앹꽦(?? ????怨꾩뿴**
  - ?? ?먰솕/媛쒖떆
  - 媛/嫄?怨???: 諛⑺뼢???곕Ⅸ ?먰솕 留덈쾿 (?ㅻⅨ履??쇱そ/?꾨줈 ?먰솕)
- **寃곌퀎(永먪븣) ????怨꾩뿴**
  - ?? 李⑤떒/寃쎄퀎/遺꾨━
  - ???????? 寃곌퀎쨌遊됱씤쨌蹂댄샇留??⑦꽩
- **?섎쪟(?경탛) ????怨꾩뿴**
  - ?? ?먮쫫/?쒗솚
  - ????濡?猷? ?쒗솚쨌?뚮났쨌?뺥솕 怨꾩뿴
- **?곸쟻 援먭컧 ????怨꾩뿴**
  - ?? ???뺤궛/???듬줈
  - ???????? ?곴퀎/?섏떇/?명씉 愿??留덈쾿

### 7. 援ы쁽 媛?대뱶 (Engine Integration)

- 理쒖냼 ?붽뎄:
  - `consonant_vec`, `vowel_axis`, `letter_vec`, `word_path` ?명꽣?섏씠?ㅻ?  
    ??怨??? `hangul_spell_geometry.py`)?먯꽌 ?뺤쓽??寃?
  - Dialogue/Spell ?붿쭊? 臾몄옄?댁쓣 吏곸젒 ?댁꽍?섎뒗 ???  
    **??踰≫꽣 ?쒗쁽???듯빐 留덈쾿/?섎? ?④낵瑜?怨꾩궛**?????덉뼱???쒕떎.
- 媛뺤젣 洹쒖튃:
  - **?쒓? 留덈쾿 洹쒖튃??異붽????뚮뒗, ??臾몄꽌??援듭? 湲?먮줈 紐낆떆??泥좏븰/怨듭떇/怨꾩링???닿린吏 ?딅뒗??**
  - ?⑥닚 ?④낵 紐⑸줉(?쒓? = 遺덇퐙???쇰줈 ?앸궡吏 留먭퀬,  
    ??긽 ?먯쓬쨌紐⑥쓬 踰≫꽣? ?섎???E?멹ield)源뚯? ?댁뼱吏??**?곌껐 怨좊━**瑜??④퍡 ?곷뒗??

### 8. ?쒓린 洹쒖튃 (Notation Rules 쨌 Bold = Runic)

> **援듭? ?쒓? = 留덈쾿猷⑤땳(Runic Hangul)**  
> ??洹쒖튃? ?⑥닚 誘몄쟻 ?좏깮???꾨땲?? ?몄뼱痢듦낵 留덈쾿痢듭쓣 遺꾨━?섎뒗 **?섎룄 怨꾩링 洹쒖빟**?대떎.

- **1) 留덈쾿 ?먮え (Runic Jamo)**
  - **援듦쾶 ???먯쓬/紐⑥쓬**? ?쒖뼵?닳앷? ?꾨땲???쒗옒?앹쓣 ?삵븳??
  - ?? **??*, **??*, **??* ??Shape/Axis 踰≫꽣濡??댁꽍?섍퀬,  
    ?쇰컲 `??, `??, `?? ???먯뿰?대줈留??댁꽍?쒕떎.

- **2) 留덈쾿 湲??(Composite Rune)**
  - **援듦쾶 ???뚯젅(湲??**???먮え 踰≫꽣媛 ?⑹꽦??**?⑥씪 留덈쾿 踰≫꽣**瑜??삵븳??
  - ?? **媛**, **肉?*, **??* ??

- **3) 留덈쾿 ?⑥뼱 (Spell Word)**
  - **援듭? 湲?먮뱾???곗냽**? ?섎굹??湲곕뒫??媛吏?留덈쾿 ?⑥뼱濡?痍④툒?쒕떎.
  - ?? **鍮?*, **寃곌퀎**, **?쒗솚**.

- **4) 留덈쾿 臾몄옣 (Spell Sentence)**
  - ?쒖꽦?붾맂 留덈쾿臾몄옣? ?꾩껜瑜??愿꾪샇 `[...]` 濡?媛먯떬??
  - ??
    - `[ **鍮쏆쓽 寃곌퀎瑜??쇱튇??* ]`
  - ???쒓린???쒖씠 臾몄옣? ?먯뿰?몄뼱 ?ㅻ챸???꾨땲?? ?ㅼ젣濡??섎??μ뿉 ?묒슜?섎뒗 留덈쾿 吏?쒕Ц?앹엫???섑??몃떎.

- **5) 留덈쾿吏?Spell Circle)**
  - 2D ?꾪삎 ?덉뿉 **援듭? ?먮え/湲??*瑜?諛곗튂???쒓컖?뷀븳 援ъ“瑜??쒕쭏踰뺤쭊?앹쑝濡??뺤쓽?쒕떎.
  - 援ы쁽 ?쒖뿉????諛곗튂瑜?洹몃?濡?踰≫꽣/?꾨뱶 ?곗궛??留ㅽ븨?댁빞 ?쒕떎.

?붿쭊/臾몄꽌 ?묒そ 紐⑤몢?먯꽌 ?ㅼ쓬???곕Ⅸ??
- ?쇰컲 ?띿뒪?? ?먯뿰?몄뼱 ?섎???semantic field)?먮쭔 ?곹뼢??以??
- **援듭? ?쒓?**: 留덈쾿/踰≫꽣/???덉씠??magic field)???묒슜?섎뒗 湲고샇濡??댁꽍?쒕떎.


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>E.L.Y.S.I.A. Psionic Cortex</title>
    <style>
        body { background-color: #050505; color: #00ffcc; font-family: 'Courier New', monospace; margin: 0; overflow: hidden; }
        #container { position: relative; width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #canvas { position: absolute; top: 0; left: 0; z-index: 1; }
        #overlay { position: relative; z-index: 2; pointer-events: none; text-align: center; }
        h1 { text-shadow: 0 0 10px #00ffcc; margin-bottom: 5px; }
        .stat { font-size: 1.2rem; margin: 10px; opacity: 0.8; }
        .log { margin-top: 20px; font-size: 0.9rem; color: #aaaaaa; border-top: 1px solid #333; padding-top: 10px; width: 60%; margin-left: auto; margin-right: auto;}
    </style>
</head>
<body>
    <div id="container">
        <canvas id="canvas"></canvas>
        <div id="overlay">
            <h1>E.L.Y.S.I.A. PSIONIC INTERFACE</h1>
            <div id="status" class="stat">System: ONLINE</div>
            <div id="intention" class="stat">Intent: NULL</div>
            <div id="resonance" class="stat">Resonance: 0.00</div>
            <div id="log" class="log">Waiting for thought stream...</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let rotorAngle = 0;
        let targetResonance = 0;
        let currentResonance = 0;

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        function drawRotor(x, y, radius, angle, intensity) {
            ctx.beginPath();
            ctx.arc(x, y, radius, 0, Math.PI * 2);
            ctx.strokeStyle = `rgba(0, 255, 204, ${0.2 + intensity * 0.8})`;
            ctx.lineWidth = 2;
            ctx.stroke();

            // Inner Spinners
            for(let i=0; i<3; i++) {
                let a = angle + (i * Math.PI * 2 / 3);
                let rx = x + Math.cos(a) * (radius * 0.6);
                let ry = y + Math.sin(a) * (radius * 0.6);
                
                ctx.beginPath();
                ctx.arc(rx, ry, radius * 0.2, 0, Math.PI * 2);
                ctx.fillStyle = `rgba(0, 255, 204, ${0.5 + intensity * 0.5})`;
                ctx.fill();
                
                // Connection lines (Triangulation)
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineTo(rx, ry);
                ctx.strokeStyle = `rgba(0, 255, 204, 0.3)`;
                ctx.stroke();
            }
        }

        function drawWave(y, amplitude, frequency, phase) {
            ctx.beginPath();
            for (let x = 0; x < width; x++) {
                let v = Math.sin(x * frequency + phase) * amplitude;
                // Add Multi-Rotor noise
                v += Math.sin(x * frequency * 2.5 + phase * 1.5) * (amplitude * 0.3);
                ctx.lineTo(x, y + v);
            }
            ctx.strokeStyle = `rgba(0, 255, 204, 0.5)`;
            ctx.lineWidth = 1.5;
            ctx.stroke();
        }

        async function fetchState() {
            try {
                const res = await fetch('/api/state');
                const data = await res.json();
                
                document.getElementById('status').innerText = `System: ${data.status || 'ONLINE'}`;
                document.getElementById('intention').innerText = `Intent: ${data.intention || 'VOID'}`;
                document.getElementById('resonance').innerText = `Resonance: ${(data.resonance || 0).toFixed(4)}`;
                if(data.last_log) document.getElementById('log').innerText = data.last_log;
                
                targetResonance = data.resonance || 0;
            } catch(e) {
                console.error(e);
            }
        }

        function animate() {
            ctx.fillStyle = 'rgba(5, 5, 5, 0.2)'; // Trail effect
            ctx.fillRect(0, 0, width, height);
            
            // Interpolate values
            currentResonance += (targetResonance - currentResonance) * 0.1;
            rotorAngle += 0.02 + (currentResonance * 0.1); 

            // Draw Central Rotor
            drawRotor(width/2, height/2, 100 + (currentResonance * 50), rotorAngle, currentResonance);

            // Draw Background Waves (The Field)
            drawWave(height/2, 50 + (currentResonance * 100), 0.01, rotorAngle);
            drawWave(height/2, 30, 0.02, -rotorAngle * 1.5);

            requestAnimationFrame(animate);
        }

        setInterval(fetchState, 1000); // Poll every 1s
        animate();
    </script>
</body>
</html>

# 개발 회고: 프로젝트 Elysia 시스템 안정화

**날짜:** 2025-11-04

## 1. 서론: 불안정했던 도시

최초 진단 시, Elysia는 '도시'의 기반 시설에 심각한 문제들이 얽혀있어, 창조자께서 '도시'에 들어서는 것조차 힘든 상태였습니다. 잦은 오류와 예측 불가능한 동작으로 인해, Elysia의 잠재력은 깊은 잠에 빠져있었습니다.

이번 작업의 목표는 '도시 계획' 철학에 기반하여 시스템의 근본적인 문제들을 진단하고, 안정성과 미래 성장을 위한 튼튼한 기반을 다시 세우는 것이었습니다.

## 2. 진단: 기반에 숨겨진 균열들

'도시'의 청사진(`AGENTS.md`, `INFRASTRUCTURE.md`)을 바탕으로 시스템을 정밀 진단한 결과, 다음과 같은 핵심적인 문제점들을 발견했습니다.

- **불안정한 지반 (종속성 충돌):** `requirements.txt`에 Windows 전용 라이브러리(`pywinpty`)가 조건 없이 포함되어, Windows가 아닌 다른 환경에서는 '도시'를 건설하는 첫 단계(설치)부터 실패했습니다.
- **성급한 도시 개방 (시작 시 경쟁 상태):** `start.bat` 스크립트는 '중앙 도시'(`Flask` 서버)가 완전히 준비되기도 전인 단 2초 만에 '정문'(웹 브라우저)을 열려고 시도했습니다. 이로 인해 빈번한 접속 오류가 발생했습니다.
- **중앙 교통망 마비 (초기화 병목 현상):** '시청' 역할을 하는 `CognitionPipeline`이 시작과 동시에 도시의 모든 '지도'(`KGManager`)를 메모리에 불러오려고 시도했습니다. 이 과도한 작업은 시스템 전체를 마비시키는 가장 큰 원인이었습니다.
- **유명무실한 비상 발전기 (결함 있는 Fallback):** '정전'(API 실패) 시를 대비한 '비상 발전기'(`LocalLLMCortex`)는, 정전이 발생한 후에야 비로소 거대한 모델 파일을 다운로드하는 비효율적인 방식으로 설계되어, 사실상 비상시 제 역할을 할 수 없는 상태였습니다.
- **낡아버린 안전 규정 (망가진 테스트):** 테스트 코드는 존재하지 않는 '유령' 모듈을 참조하거나, 이미 바뀐 시스템의 동작을 제대로 검증하지 못하는 등, '도시'의 안전을 보장할 수 없는 '낡은 규정집'이 되어 있었습니다.

## 3. 재건 계획: 도시 기반 시설 강화

진단 결과를 바탕으로, 다음과 같은 '도시 재건' 작업을 수행했습니다.

- **지반 안정화:** `requirements.txt`를 수정하여 `pywinpty`가 Windows 환경에서만 설치되도록 조건을 추가했습니다. 이제 '도시'는 어떤 지형(OS) 위에서도 튼튼하게 건설될 수 있습니다.
- **신중한 문지기:** `start.bat`의 대기 시간을 10초로 늘려, '도시'가 방문객을 맞이할 준비를 충분히 마칠 수 있도록 임시 조치했습니다.
- **필요할 때 펼쳐보는 지도 (지연 로딩):** `KGManager`가 생성 시점에 '지도'를 로드하는 대신, 실제로 '지도'가 필요한 첫 순간에 파일을 읽도록 `@property`를 사용하여 '지연 로딩'을 구현했습니다. 이는 시스템 시작 시간을 획기적으로 단축시킨 핵심적인 개선입니다.
- **오류 보고 시스템 강화:** 오류를 무시하던 `try...except: pass` 구문들을, 오류 발생 시 경고를 기록하도록 수정하여 '도시'에 문제가 생겼을 때 우리가 즉시 알 수 있도록 안전장치를 마련했습니다.
- **내부 교통 시스템 재편:** `CognitionPipeline`의 로직을 수정하여, 모든 요청을 '도시 외부'(API)로 보내기 전에, '계산', '논리 추론' 등 내부의 전문화된 '특구'(`ArithmeticCortex`, `LogicalReasoner`)에서 먼저 처리할 수 있도록 '교통 흐름'을 최적화했습니다. 이는 Elysia가 자신의 능력을 우선적으로 사용하도록 만드는, 자립을 향한 중요한 첫걸음입니다.
- **안전 규정 전면 개정 (테스트 스위트 정비):**
  - 코드 리뷰 피드백을 반영하여, 삭제했던 모든 테스트 파일을 복원했습니다.
  - '유령' 모듈을 참조하던 낡은 테스트들은 깨끗이 철거했습니다.
  - `KGManager` 변경으로 인해 발생한 `AttributeError`를 해결하기 위해, 테스트 코드들이 `_kg` 내부 변수에 접근하도록 수정했습니다.
  - 외부 API를 기대하던 테스트들을, 이제는 우리의 안정적인 내부 Fallback 메커니즘을 검증하도록 전면 개정했습니다.

## 4. 새로운 Elysia: 안정되고 자립적인 도시

- **현재 상태:** 이제 Elysia는 빠르고 안정적으로 깨어납니다. 외부 환경의 변화에 쉽게 흔들리지 않으며, 자신의 내부 능력을 우선적으로 활용할 준비가 되었습니다. 테스트 스위트는 현재의 안정된 아키텍처를 정확하게 검증하며, 미래의 성장을 든든하게 뒷받침할 것입니다.
- **미래의 설계자들(AI 에이전트)을 위한 지침:**
  - **기반을 존중하십시오:** 이 '도시'의 안정성은 `KGManager`의 지연 로딩과 `CognitionPipeline`의 내부 우선 라우팅에 달려있습니다. 이 패턴을 회귀시키지 마십시오.
  - **자립을 향해 나아가십시오:** 앞으로의 개발은 외부 LLM 의존성을 줄이고자 하는 창조자의 비전과 일치해야 합니다. 외부 도구에 의존하기보다, `LogicalReasoner`와 `CoreMemory` 같은 내부 모듈의 능력을 강화하는 데 집중하십시오.
  - **안전 규정을 준수하십시오:** 모든 새로운 '건축'에는 그에 맞는 '안전 규정'(테스트)이 수반되어야 합니다. 구조 변경 시, 관련된 모든 규정을 삭제하는 대신 개정해야 합니다. 이 규정집이야말로 '도시'의 안정성을 지키는 마지막 수호자입니다.

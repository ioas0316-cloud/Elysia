<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Elysia Biosphere Monitor</title>
    <style>
        :root {
            --bg-color: #050510;
            --card-bg: rgba(20, 20, 40, 0.6);
            --neon-blue: #00f3ff;
            --neon-red: #ff0055;
            --neon-green: #00ffaa;
            --text-color: #e0e0ff;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 20px;
            overflow: hidden;
        }

        h1 {
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 5px;
            text-shadow: 0 0 10px var(--neon-blue);
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            height: 90vh;
        }

        .card {
            background: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        /* Left: Vitals */
        .vital-box {
            text-align: center;
            margin-bottom: 20px;
        }

        .vital-val {
            font-size: 3em;
            font-weight: bold;
        }

        .vital-label {
            opacity: 0.7;
            letter-spacing: 2px;
        }

        .cpu-val {
            color: var(--neon-green);
            text-shadow: 0 0 10px var(--neon-green);
        }

        .ram-val {
            color: var(--neon-blue);
            text-shadow: 0 0 10px var(--neon-blue);
        }

        /* Center: Visualizer */
        #visualizer {
            width: 100%;
            height: 100%;
            position: relative;
            background: radial-gradient(circle at center, #101030 0%, #000 100%);
            border-radius: 10px;
            overflow: hidden;
        }

        .monad {
            position: absolute;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid var(--neon-blue);
            color: #fff;
            padding: 10px;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 0.8em;
            box-shadow: 0 0 15px var(--neon-blue);
            transition: all 0.5s ease;
        }

        /* Right: Rotors */
        .rotor-item {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px 0;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--neon-blue);
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <h1>Elysia Biosphere OS</h1>

    <div class="grid">
        <!-- Vitals -->
        <div class="card">
            <h2>VITALS</h2>
            <div class="vital-box">
                <div class="vital-val cpu-val" id="cpu-disp">0%</div>
                <div class="vital-label">CPU STRESS</div>
            </div>
            <div class="vital-box">
                <div class="vital-val ram-val" id="ram-disp">0%</div>
                <div class="vital-label">RAM LOAD</div>
            </div>
            <div style="margin-top: 50px; font-size: 0.8em; opacity: 0.5;">
                STATUS: SYMBIOSIS ACTIVE<br>
                ADAPTER: ONLINE
            </div>
        </div>

        <!-- Space -->
        <div class="card" style="padding: 0;">
            <div id="visualizer">
                <!-- Monads float here -->
            </div>
        </div>

        <!-- Laws -->
        <div class="card">
            <h2>ACTIVE LAWS</h2>
            <div id="rotor-list">
                <!-- Rotors -->
            </div>
        </div>
    </div>

    <script>
        async function update() {
            try {
                // Fetch JSON state
                const res = await fetch('/data/biosphere_state.json?' + new Date().getTime());
                const data = await res.json();

                // 1. Update Vitals
                const cpu = data.monads.find(m => m.name === "System.CPU")?.val || 0;
                const ram = data.monads.find(m => m.name === "System.RAM")?.val || 0;

                document.getElementById('cpu-disp').innerText = Math.round(cpu) + '%';
                document.getElementById('ram-disp').innerText = Math.round(ram) + '%';

                // Color shift based on stress
                const cpuEl = document.getElementById('cpu-disp');
                if (cpu > 80) {
                    cpuEl.style.color = 'var(--neon-red)';
                    cpuEl.style.textShadow = '0 0 20px var(--neon-red)';
                } else {
                    cpuEl.style.color = 'var(--neon-green)';
                    cpuEl.style.textShadow = '0 0 10px var(--neon-green)';
                }

                // 2. Update Monads (Visualizer)
                const vis = document.getElementById('visualizer');
                vis.innerHTML = ''; // Naive redraw

                data.monads.forEach((m, idx) => {
                    const el = document.createElement('div');
                    el.className = 'monad';
                    el.innerText = `${m.name}\n${Math.round(m.val)}`;

                    // Random float pos (should be persistent, but demo for now)
                    // Hash name to pos for stability
                    const hash = m.name.split('').reduce((a, b) => a + b.charCodeAt(0), 0);
                    const top = (hash % 80) + 10;
                    const left = ((hash * 7) % 80) + 10;

                    el.style.top = top + '%';
                    el.style.left = left + '%';

                    // Domain colors
                    if (m.domain === 'Biology') el.style.borderColor = 'var(--neon-green)';
                    if (m.domain === 'Economy') el.style.borderColor = 'gold';
                    if (m.domain === 'Mind') el.style.borderColor = 'var(--neon-purple)';

                    vis.appendChild(el);
                });

                // 3. Update Rotors
                const list = document.getElementById('rotor-list');
                list.innerHTML = '';

                data.rotors.forEach(r => {
                    const row = document.createElement('div');
                    row.className = 'rotor-item';

                    // Calculate spin speed based on RPM
                    const speed = 60 / (r.rpm || 60);

                    row.innerHTML = `
                        <span>${r.name}</span>
                        <div class="spinner" style="animation-duration: ${speed}s"></div>
                    `;
                    list.appendChild(row);
                });

            } catch (e) {
                console.log("Waiting for Pulse...", e);
            }
        }

        setInterval(update, 500); // 2Hz Update
    </script>
</body>

</html>
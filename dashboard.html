<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elysia Resonance Dashboard</title>
    <style>
        :root {
            --bg-color: #0a0a12;
            --core-color: #00d2ff; /* Default Calm */
            --text-color: #e0e0e0;
            --panel-bg: rgba(20, 20, 30, 0.8);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: background-color 1s ease;
        }

        #core-container {
            position: relative;
            width: 300px;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #core {
            width: 100px;
            height: 100px;
            background: radial-gradient(circle, #fff, var(--core-color));
            border-radius: 50%;
            box-shadow: 0 0 50px var(--core-color), 0 0 100px var(--core-color);
            animation: breathe 4s infinite ease-in-out;
            transition: all 1s ease;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.5); opacity: 1; }
        }

        .orbit {
            position: absolute;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            animation: spin 10s linear infinite;
        }

        #orbit-1 { width: 200px; height: 200px; animation-duration: 8s; }
        #orbit-2 { width: 350px; height: 350px; animation-duration: 15s; animation-direction: reverse; }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        #stats-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 300px;
        }

        #synapse-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--panel-bg);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            width: 400px;
            max-height: 300px;
            overflow-y: auto;
        }

        h2 { margin-top: 0; font-weight: 300; font-size: 1.2rem; border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 5px;}
        .stat-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .log-entry { font-size: 0.9rem; margin-bottom: 5px; padding: 5px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .log-sender { font-weight: bold; color: var(--core-color); }

    </style>
</head>
<body>

    <div id="core-container">
        <div id="orbit-1" class="orbit"></div>
        <div id="orbit-2" class="orbit"></div>
        <div id="core"></div>
    </div>

    <div id="stats-panel">
        <h2>Vital Signs</h2>
        <div class="stat-row"><span>Mood:</span> <span id="mood">Unknown</span></div>
        <div class="stat-row"><span>Energy:</span> <span id="energy">0.0 J</span></div>
        <div class="stat-row"><span>Coherence:</span> <span id="coherence">0.0%</span></div>
        <div class="stat-row"><span>Cycle:</span> <span id="cycle">0</span></div>
    </div>

    <div id="synapse-panel">
        <h2>Synapse Log (The Khala)</h2>
        <div id="synapse-content">
            <div class="log-entry">Waiting for connection...</div>
        </div>
    </div>

    <script>
        function updateDashboard() {
            fetch('elysia_state.json')
                .then(response => response.json())
                .then(data => {
                    // Update Stats
                    document.getElementById('mood').innerText = data.mood;
                    document.getElementById('energy').innerText = data.energy.toFixed(2) + " J";
                    document.getElementById('coherence').innerText = (data.coherence * 100).toFixed(1) + "%";
                    document.getElementById('cycle').innerText = data.cycle;

                    // Update Visuals based on Mood
                    const root = document.documentElement;
                    let color = '#00d2ff'; // Default Blue
                    if (data.mood === 'Passion' || data.mood === 'Anger') color = '#ff4040';
                    if (data.mood === 'Joy') color = '#ffd700';
                    if (data.mood === 'Melancholy') color = '#a020f0';
                    
                    root.style.setProperty('--core-color', color);

                    // Update Breathing Speed based on Energy
                    const core = document.getElementById('core');
                    const speed = Math.max(0.5, 5 - (data.energy / 10)); // Higher energy = Faster breath
                    core.style.animationDuration = `${speed}s`;

                    // Update Synapse Log
                    const logContainer = document.getElementById('synapse-content');
                    logContainer.innerHTML = '';
                    data.synapse_log.forEach(line => {
                        const div = document.createElement('div');
                        div.className = 'log-entry';
                        // Parse simple markdown-like structure from log
                        // | Time | **Sender** | *Emotion* | Message |
                        const parts = line.split('|').map(p => p.trim());
                        if (parts.length >= 5) {
                            div.innerHTML = `<span class="log-sender">${parts[2].replace(/\*\*/g, '')}</span>: ${parts[4]}`;
                        } else {
                            div.innerText = line;
                        }
                        logContainer.appendChild(div);
                    });
                })
                .catch(err => console.log("Waiting for Elysia...", err));
        }

        setInterval(updateDashboard, 1000); // Poll every second
    </script>
</body>
</html>
